<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Risk Predictor</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4 font-inter">

    <!-- Header and User ID Section -->
    <header class="bg-white rounded-xl shadow-md p-6 mb-8 w-full max-w-2xl text-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Health Risk Predictor</h1>
        <p class="text-gray-600 mb-4">By Gourav Rajput</p>
        <div id="user-info" class="text-sm text-gray-700">
            Welcome! Your User ID: <span id="user-id" class="font-semibold text-blue-600">Loading...</span>
            <button id="sign-in-out-button" class="ml-4 px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200">Sign In / Register</button>
        </div>
        <p id="firebase-error" class="text-red-600 text-sm mt-2 hidden">Critical error initializing Firebase: Please check console.</p>
    </header>

    <!-- Main Content Area -->
    <main class="bg-white rounded-xl shadow-md p-8 w-full max-w-2xl">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Your Health Matters</h2>

        <!-- Disease Selection Dropdown -->
        <div class="mb-6">
            <label for="diseaseSelect" class="block text-gray-700 text-sm font-bold mb-2">Select Disease for Prediction:</label>
            <select id="diseaseSelect" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline transition-all duration-200">
                <option value="diabetes">Diabetes</option>
                <option value="heart_disease">Heart Disease</option>
            </select>
        </div>

        <!-- Diabetes Prediction Form -->
        <div id="diabetesForm" class="prediction-form space-y-4">
            <h3 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">Diabetes Prediction</h3>
            <div>
                <label for="gender" class="block text-gray-700 text-sm font-bold mb-2">Gender:</label>
                <select id="gender" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select Gender</option>
                    <option value="Female">Female</option>
                    <option value="Male">Male</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div>
                <label for="age" class="block text-gray-700 text-sm font-bold mb-2">Age:</label>
                <input type="number" id="age" placeholder="e.g., 35" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div>
                <label for="hypertension" class="block text-gray-700 text-sm font-bold mb-2">Hypertension:</label>
                <select id="hypertension" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
            <div>
                <label for="heart_disease" class="block text-gray-700 text-sm font-bold mb-2">Heart Disease:</label>
                <select id="heart_disease" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
            <div>
                <label for="smoking_history" class="block text-gray-700 text-sm font-bold mb-2">Smoking History:</label>
                <select id="smoking_history" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select Smoking History</option>
                    <option value="never">Never</option>
                    <option value="No Info">No Info</option>
                    <option value="current">Current</option>
                    <option value="ever">Ever</option>
                    <option value="former">Former</option>
                    <option value="not current">Not Current</option>
                </select>
            </div>
            <div>
                <label for="bmi" class="block text-gray-700 text-sm font-bold mb-2">BMI:</label>
                <input type="number" step="0.01" id="bmi" placeholder="e.g., 25.5" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div>
                <label for="HbA1c_level" class="block text-gray-700 text-sm font-bold mb-2">HbA1c Level:</label>
                <input type="number" step="0.01" id="HbA1c_level" placeholder="e.g., 6.1" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div>
                <label for="blood_glucose_level" class="block text-gray-700 text-sm font-bold mb-2">Blood Glucose Level:</label>
                <input type="number" id="blood_glucose_level" placeholder="e.g., 140" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <button id="predictDiabetesBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md w-full transition-colors duration-200">Predict Diabetes Risk</button>
        </div>

        <!-- Heart Disease Prediction Form -->
        <div id="heartDiseaseForm" class="prediction-form space-y-4 hidden">
            <h3 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">Heart Disease Prediction</h3>
            <div>
                <label for="hd_age" class="block text-gray-700 text-sm font-bold mb-2">Age:</label>
                <input type="number" id="hd_age" placeholder="e.g., 50" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div>
                <label for="hd_sex" class="block text-gray-700 text-sm font-bold mb-2">Sex:</label>
                <select id="hd_sex" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select Sex</option>
                    <option value="1">Male</option>
                    <option value="0">Female</option>
                </select>
            </div>
            <div>
                <label for="hd_cp" class="block text-gray-700 text-sm font-bold mb-2">Chest Pain Type (CP):</label>
                <select id="hd_cp" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select CP Type</option>
                    <option value="0">Typical Angina (0)</option>
                    <option value="1">Atypical Angina (1)</option>
                    <option value="2">Non-anginal Pain (2)</option>
                    <option value="3">Asymptomatic (3)</option>
                </select>
            </div>
            <div>
                <label for="hd_trestbps" class="block text-gray-700 text-sm font-bold mb-2">Resting Blood Pressure (trestbps):</label>
                <input type="number" id="hd_trestbps" placeholder="e.g., 120" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div>
                <label for="hd_chol" class="block text-gray-700 text-sm font-bold mb-2">Serum Cholesterol (chol):</label>
                <input type="number" id="hd_chol" placeholder="e.g., 240" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div>
                <label for="hd_fbs" class="block text-gray-700 text-sm font-bold mb-2">Fasting Blood Sugar > 120 mg/dl (fbs):</label>
                <select id="hd_fbs" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
            <div>
                <label for="hd_restecg" class="block text-gray-700 text-sm font-bold mb-2">Resting Electrocardiographic Results (restecg):</label>
                <select id="hd_restecg" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select</option>
                    <option value="0">Normal (0)</option>
                    <option value="1">ST-T Wave Abnormality (1)</option>
                    <option value="2">Left Ventricular Hypertrophy (2)</option>
                </select>
            </div>
            <div>
                <label for="hd_thalach" class="block text-gray-700 text-sm font-bold mb-2">Maximum Heart Rate Achieved (thalach):</label>
                <input type="number" id="hd_thalach" placeholder="e.g., 150" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div>
                <label for="hd_exang" class="block text-gray-700 text-sm font-bold mb-2">Exercise Induced Angina (exang):</label>
                <select id="hd_exang" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
            <div>
                <label for="hd_oldpeak" class="block text-gray-700 text-sm font-bold mb-2">ST Depression Induced by Exercise (oldpeak):</label>
                <input type="number" step="0.1" id="hd_oldpeak" placeholder="e.g., 1.5" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div>
                <label for="hd_slope" class="block text-gray-700 text-sm font-bold mb-2">Slope of the Peak Exercise ST Segment (slope):</label>
                <select id="hd_slope" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select</option>
                    <option value="0">Upsloping (0)</option>
                    <option value="1">Flat (1)</option>
                    <option value="2">Downsloping (2)</option>
                </select>
            </div>
            <div>
                <label for="hd_ca" class="block text-gray-700 text-sm font-bold mb-2">Number of Major Vessels (0-3) Colored by Flourosopy (ca):</label>
                <select id="hd_ca" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">Unknown (often '?' in dataset)</option>
                </select>
            </div>
            <div>
                <label for="hd_thal" class="block text-gray-700 text-sm font-bold mb-2">Thal (Thalassemia) (thal):</label>
                <select id="hd_thal" class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Select</option>
                    <option value="0">No Info (often '?' in dataset)</option>
                    <option value="1">Normal (1)</option>
                    <option value="2">Fixed Defect (2)</option>
                    <option value="3">Reversible Defect (3)</option>
                </select>
            </div>
            <button id="predictHeartDiseaseBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md w-full transition-colors duration-200">Predict Heart Disease Risk</button>
        </div>

        <!-- Prediction Result Display -->
        <div id="result" class="mt-6 p-4 bg-blue-100 rounded-md text-blue-800 hidden">
            <p id="predictionText" class="font-semibold text-lg"></p>
            <p id="probabilityText" class="text-sm"></p>
        </div>
    </main>

    <!-- Past Predictions Section -->
    <section class="bg-white rounded-xl shadow-md p-8 mt-8 w-full max-w-2xl">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Past Predictions</h2>
        <div id="past-predictions-list" class="space-y-4">
            <!-- Predictions will be loaded here dynamically -->
            <p class="text-gray-500 text-center" id="no-predictions-message">No past predictions yet. Make a prediction to see it here!</p>
        </div>
    </section>

    <!-- Firebase SDK Imports -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // IMPORTANT: The firebaseConfig object itself is now moved to script.js!
        // This 'firebaseConfig' object should NOT be here.
        // It will be loaded from the external script.js file.

        // Placeholder for app, auth, db to be assigned in script.js
        let app;
        let auth;
        let db;
        let userId;

        // Ensure script.js is loaded correctly and initializes Firebase
        // The script.js will handle the Firebase initialization
        // We're just keeping the SDK imports here.
    </script>
    <script type="module" src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
